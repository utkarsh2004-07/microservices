events {}

http {
    # ğŸ”— Internal service hostnames (from docker-compose service names)
    upstream auth_service {
        server auth:4000;
    }

    upstream task_service {
        server task:4001;
    }

    server {
        listen 80;

        # ğŸ” Internal path for JWT validation
        location /_validate {
            internal;
            proxy_pass http://auth_service/validate;
        }

        # ğŸŒ Public routes (NO JWT required)
        location /auth/ {
            proxy_pass http://auth_service;
        }

        # ğŸ”’ Protected routes (JWT REQUIRED)
        location /tasks/ {
            auth_request /_validate;
            proxy_pass http://task_service;
        }

        # ğŸ  Root test endpoint
        location / {
            return 200 "API Gateway is running ğŸš€";
        }
    }
}
